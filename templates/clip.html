<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clip Agent - MediaAgentIQ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body class="bg-slate-950 min-h-screen text-white">
    <!-- Navigation -->
    <nav class="bg-slate-900 border-b border-slate-800 px-6 py-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <a href="/" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                </a>
                <span class="text-3xl">üé¨</span>
                <h1 class="text-2xl font-bold">Clip Agent</h1>
            </div>
            <span class="px-3 py-1 bg-purple-500/20 text-purple-400 rounded-full text-sm">
                10x Social Content
            </span>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-6 py-8">
        <div class="grid grid-cols-2 gap-8">
            <!-- Upload Section -->
            <div class="bg-slate-900 rounded-xl p-6 border border-slate-800">
                <h2 class="text-xl font-semibold mb-4">Upload Video</h2>
                <form id="clip-form" enctype="multipart/form-data">
                    <div class="border-2 border-dashed border-slate-700 rounded-xl p-8 text-center hover:border-purple-500 transition cursor-pointer" id="drop-zone">
                        <input type="file" id="file-input" class="hidden" accept=".mp4,.mov,.avi,.mkv,.webm">
                        <div class="text-6xl mb-4">üé•</div>
                        <p class="text-gray-400 mb-2">Drag & drop your video file</p>
                        <p class="text-gray-500 text-sm">MP4, MOV, AVI, MKV, WebM</p>
                        <button type="button" onclick="document.getElementById('file-input').click()" class="mt-4 bg-purple-500 hover:bg-purple-600 px-4 py-2 rounded-lg transition">
                            Browse Files
                        </button>
                    </div>
                    <div id="file-preview" class="hidden mt-4 p-4 bg-slate-800 rounded-lg">
                        <div class="flex items-center justify-between">
                            <span id="file-name" class="text-gray-300"></span>
                            <button type="button" onclick="clearFile()" class="text-red-400 hover:text-red-300">Remove</button>
                        </div>
                    </div>
                    <button type="submit" id="process-btn" class="w-full mt-4 bg-purple-500 hover:bg-purple-600 disabled:bg-slate-700 disabled:cursor-not-allowed py-3 rounded-lg font-semibold transition" disabled>
                        Find Viral Moments
                    </button>
                </form>

                <div id="processing" class="hidden mt-6">
                    <div class="flex items-center space-x-3">
                        <div class="animate-spin w-6 h-6 border-2 border-purple-500 border-t-transparent rounded-full"></div>
                        <span class="text-gray-300">Analyzing video for viral moments...</span>
                    </div>
                </div>
            </div>

            <!-- Features -->
            <div class="bg-slate-900 rounded-xl p-6 border border-slate-800">
                <h2 class="text-xl font-semibold mb-4">Clip Agent Features</h2>
                <div class="space-y-4">
                    <div class="flex items-start space-x-3">
                        <span class="text-2xl">üî•</span>
                        <div>
                            <h3 class="font-medium">Viral Moment Detection</h3>
                            <p class="text-gray-400 text-sm">AI identifies emotionally engaging moments</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-3">
                        <span class="text-2xl">üìä</span>
                        <div>
                            <h3 class="font-medium">Engagement Prediction</h3>
                            <p class="text-gray-400 text-sm">Score each clip for viral potential</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-3">
                        <span class="text-2xl">üì±</span>
                        <div>
                            <h3 class="font-medium">Multi-Platform Export</h3>
                            <p class="text-gray-400 text-sm">Optimized for TikTok, Reels, Shorts</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-3">
                        <span class="text-2xl">#Ô∏è‚É£</span>
                        <div>
                            <h3 class="font-medium">Auto Hashtags</h3>
                            <p class="text-gray-400 text-sm">AI-generated trending hashtags</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results" class="hidden mt-8">
            <div class="bg-slate-900 rounded-xl p-6 border border-slate-800">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold">Viral Moments Detected</h2>
                    <div class="text-gray-400">
                        <span id="moments-count">0</span> moments found
                    </div>
                </div>

                <div id="clips-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Clips will be inserted here -->
                </div>
            </div>

            <!-- Social Posts -->
            <div class="bg-slate-900 rounded-xl p-6 border border-slate-800 mt-6">
                <h2 class="text-xl font-semibold mb-4">Suggested Social Posts</h2>
                <div id="social-posts" class="grid grid-cols-3 gap-4">
                    <!-- Social posts will be inserted here -->
                </div>
            </div>
        </div>
    </main>

    <script>
        let clipData = null;
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const processBtn = document.getElementById('process-btn');

        // File handling
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('border-purple-500');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('border-purple-500');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-purple-500');
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                showFilePreview(e.dataTransfer.files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) showFilePreview(e.target.files[0]);
        });

        function showFilePreview(file) {
            document.getElementById('file-name').textContent = file.name;
            document.getElementById('file-preview').classList.remove('hidden');
            processBtn.disabled = false;
        }

        function clearFile() {
            fileInput.value = '';
            document.getElementById('file-preview').classList.add('hidden');
            processBtn.disabled = true;
        }

        document.getElementById('clip-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            document.getElementById('processing').classList.remove('hidden');
            processBtn.disabled = true;

            try {
                const response = await fetch('/api/clip/process', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();
                if (result.success) {
                    clipData = result.data;
                    displayResults(result.data);
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                document.getElementById('processing').classList.add('hidden');
                processBtn.disabled = false;
            }
        });

        function displayResults(data) {
            document.getElementById('results').classList.remove('hidden');
            document.getElementById('moments-count').textContent = data.viral_moments.length;

            const clipsGrid = document.getElementById('clips-grid');
            clipsGrid.innerHTML = data.suggested_clips.map(clip => `
                <div class="bg-slate-800 rounded-lg overflow-hidden">
                    <div class="aspect-video bg-slate-700 flex items-center justify-center">
                        <span class="text-6xl">üé¨</span>
                    </div>
                    <div class="p-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm text-purple-400">${formatTime(clip.start)} - ${formatTime(clip.end)}</span>
                            <span class="px-2 py-1 bg-green-500/20 text-green-400 rounded text-xs">
                                ${Math.round(clip.viral_score * 100)}% viral
                            </span>
                        </div>
                        <h3 class="font-medium mb-2">${clip.title}</h3>
                        <p class="text-gray-400 text-sm mb-3">${clip.description}</p>
                        <div class="flex flex-wrap gap-1 mb-3">
                            ${clip.hashtags.slice(0, 4).map(h => `<span class="text-xs text-blue-400">${h}</span>`).join(' ')}
                        </div>
                        <div class="flex gap-2">
                            <button class="flex-1 bg-purple-500/20 text-purple-400 py-2 rounded text-sm hover:bg-purple-500/30 transition">
                                Export
                            </button>
                            <button class="flex-1 bg-blue-500/20 text-blue-400 py-2 rounded text-sm hover:bg-blue-500/30 transition">
                                Preview
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');

            const socialPosts = document.getElementById('social-posts');
            socialPosts.innerHTML = data.social_posts.slice(0, 6).map(post => `
                <div class="bg-slate-800 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-medium text-sm">${post.platform}</span>
                        <span class="text-xs text-gray-500">${post.best_time}</span>
                    </div>
                    <p class="text-gray-300 text-sm line-clamp-4">${post.text}</p>
                    <button class="mt-3 w-full bg-slate-700 hover:bg-slate-600 py-2 rounded text-sm transition">
                        Copy Post
                    </button>
                </div>
            `).join('');
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
    </script>
</body>
</html>
